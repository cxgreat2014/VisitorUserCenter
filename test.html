<script>
///////////////////////////////////////////////////////////////////////////////
//              Z-Blog
// 作    者:    朱煊(zx.asd)
// 版权所有:    RainbowSoft Studio
// 技术支持:    rainbowsoft@163.com
// 程序名称:
// 程序版本:
// 单元名称:    common.js
// 开始时间:    2004.07.25
// 最后修改:
// 备    注:    全局脚本
///////////////////////////////////////////////////////////////////////////////

//*********************************************************
// 目的：    设置Cookie
// 输入：    sName, sValue,iExpireDays
// 返回：    无
//*********************************************************
function SetCookie(sName, sValue, iExpireDays) {
var path = (typeof(cookiespath) == "undefined") ? "/": cookiespath;
if (iExpireDays) {
var dExpire = new Date();
dExpire.setTime(dExpire.getTime() + parseInt(iExpireDays * 24 * 60 * 60 * 1000));
document.cookie = sName + "=" + escape(sValue) + "; expires=" + dExpire.toGMTString() + "; path=" + path;
} else {
document.cookie = sName + "=" + escape(sValue) + "; path=" + path;
}
}
//*********************************************************

//*********************************************************
// 目的：    返回Cookie
// 输入：    Name
// 返回：    Cookie值
//*********************************************************
function GetCookie(sName) {

var arr = document.cookie.match(new RegExp("(^| )" + sName + "=([^;]*)(;|$)"));
if (arr != null) {
return unescape(arr[2])
};
return null;

}
//*********************************************************

//*********************************************************
// 目的：    验证信息
// 输入：    无
// 返回：    无
//*********************************************************
function VerifyMessage() {

var strFormAction = $("#inpId").parent("form").attr("action");
var strName = $("#inpName").val();
var strEmail = $("#inpEmail").val();
var strHomePage = $("#inpHomePage").val();
var strVerify = $("#inpVerify").val();
var strArticle = $("#txaArticle").val();
var intReplyID = $("#inpRevID").val();
var intPostID = $("#inpId").val();
var intMaxLen = 1000;

if (strName == "") {
alert((typeof(lang_comment_name_error) == "undefined") ? "name error": lang_comment_name_error);
return false;
} else {
re = new RegExp("^[\.\_A-Za-z0-9\u4e00-\u9fa5]+$");
if (!re.test(strName)) {
alert((typeof(lang_comment_name_error) == "undefined") ? "name error": lang_comment_name_error);
return false;
}
}

if (strEmail == "") {
//alert(str01);
//return false;
} else {
re = new RegExp("^[\\w-]+(\\.[\\w-]+)*@[\\w-]+(\\.[\\w-]+)+$");
if (!re.test(strEmail)) {
alert((typeof(lang_comment_email_error) == "undefined") ? "email error": lang_comment_email_error);
return false;
}
}

if (typeof(strArticle) == "string") {
if (strArticle == "") {
alert((typeof(lang_comment_content_error) == "undefined") ? "content error": lang_comment_content_error);
return false;
}
if (strArticle.length > intMaxLen) {
alert((typeof(lang_comment_content_error) == "undefined") ? "content error": lang_comment_content_error);
return false;
}
}

//ajax comment begin
var strSubmit = $("#inpId").parent("form").find(":submit").val();
$("#inpId").parent("form").find(":submit").val("Waiting...").attr("disabled", "disabled").addClass("loading");

$.post(strFormAction, {
"isajax": true,
"postid": intPostID,
"verify": strVerify,
"name": strName,
"email": strEmail,
"content": strArticle,
"homepage": strHomePage,
"replyid": intReplyID
},
function(data) {

$("#inpId").parent("form").find(":submit").removeClass("loading");
$("#inpId").parent("form").find(":submit").removeAttr("disabled");
$("#inpId").parent("form").find(":submit").val(strSubmit);

var s = data;
if ((s.search("faultCode") > 0) && (s.search("faultString") > 0)) {
alert(s.match("<string>.+?</string>")[0].replace("<string>", "").replace("</string>", ""))
} else {
var s = data;
var cmt = s.match(/cmt\d+/);
if (intReplyID == 0) {
$(s).insertAfter("#AjaxCommentBegin");
} else {
$(s).insertAfter("#AjaxComment" + intReplyID);
}
window.location = "#" + cmt;
$("#txaArticle").val("");

SaveRememberInfo();
CommentComplete();
}

});

return false;
//ajax comment end
}
//*********************************************************

//*********************************************************
// 目的：    加载信息
// 输入：    无
// 返回：    无
//*********************************************************
function LoadRememberInfo() {

var strName = GetCookie("name");
var strEmail = GetCookie("email");
var strHomePage = GetCookie("homepage");

if (strName) {
$("#inpName").val(strName);
}
if (strEmail) {
$("#inpEmail").val(strEmail);
}
if (strHomePage) {
$("#inpHomePage").val(strHomePage);
}

}
//*********************************************************

//*********************************************************
// 目的：    保存信息
// 输入：    无
// 返回：    无
//*********************************************************
function SaveRememberInfo() {

var strName = $("#inpName").val();
var strEmail = $("#inpEmail").val();
var strHomePage = $("#inpHomePage").val();

SetCookie("name", strName, 365);
SetCookie("email", strEmail, 365);
SetCookie("homepage", strHomePage, 365);

}
//*********************************************************

//*********************************************************
// 目的：    回复留言
// 输入：    无
// 返回：    无
//*********************************************************
function RevertComment(i) {

$("#inpRevID").val(i);

$("#cancel-reply").show().bind("click",
function() {
$("#inpRevID").val(0);
$(this).hide();
window.location.hash = "#comment";
return false;
});

window.location.hash = "#comment";
}
//*********************************************************

//*********************************************************
// 目的：
//*********************************************************
function GetComments(postid, page) {
$.get(bloghost + "zb_system/cmd.php?act=getcmt&postid=" + postid + "&page=" + page,
function(data) {
$('#AjaxCommentBegin').nextUntil('#AjaxCommentEnd').remove();
$('#AjaxCommentBegin').after(data);
});

}
//*********************************************************

//*********************************************************
// 目的：  预留空函数,留给主题或插件用
//*********************************************************
function CommentComplete() {}
//*********************************************************
</script>